\begin{figure*}
    \centering
    \begin{tikzpicture}
        \begin{groupplot}[group style={
                        group size=2 by 3,
                        xlabels at=edge bottom,
                        ylabels at=edge left,
                        xticklabels at=edge bottom,
                        % yticklabels at=edge left,
                        vertical sep=1.5cm,
                    },
                height=5.7cm,
                width=7.5cm,
                xlabel={Message Size (Bytes)},
                ylabel={Latency ($\mu$s)},
                xticklabels={4B, 256B, 16kB, 1MB, 64MB},
                legend style={at={(-0.1,-0.3)}, anchor=north},
                legend columns=5,
                grid=major,
                cycle list name=bk_remap_omb_blg_cyclelist,
            ]
            
            
            \nextgroupplot[title=GPU By Socket, xmode=log, log basis x=2, ymode=log, log basis y=10, restrict y to domain=0:1100, xmin=2, xmax=268435456] 
            \addplot table[x=msize, y=rsa] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bysoc_128.dat};
            \addplot table[x=msize, y=ring] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bysoc_128.dat};
            \addplot table[x=msize, y=rdouble] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bysoc_128.dat};
            % \addplot table[x=msize, y=min] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bysoc_128.dat};
            \addplot table[x=msize, y=scotch] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bysoc_128.dat};
            \addplot table[x=msize, y=def] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bysoc_128.dat};
            
            \nextgroupplot[title=CPU By Socket, xmode=log, log basis x=2, ymode=log, log basis y=10, restrict y to domain=0:1100, xmin=2, xmax=268435456]
            \addplot table[x=msize, y=socket_disabled0_alg6_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            \addplot table[x=msize, y=socket_disabled0_alg4_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            \addplot table[x=msize, y=socket_disabled0_alg3_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            % \addplot table[x=msize, y=socket_disabled0_alg0_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            \addplot table[x=msize, y=socket_disabled0_alg0_scotch1] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            \addplot table[x=msize, y=socket_disabled1_alg0_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            
            \nextgroupplot[title=GPU By Core, xmode=log, log basis x=2, ymode=log, log basis y=10, restrict y to domain=0:1100, xmin=2, xmax=268435456]
            \addplot table[x=msize, y=rsa] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bycore_128.dat};
            \addplot table[x=msize, y=ring] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bycore_128.dat};
            \addplot table[x=msize, y=rdouble] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bycore_128.dat};
            % \addplot table[x=msize, y=min] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bycore_128.dat};
            \addplot table[x=msize, y=scotch] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bycore_128.dat};
            \addplot table[x=msize, y=def] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bycore_128.dat};
            
            \nextgroupplot[title=CPU By Core, xmode=log, log basis x=2, ymode=log, log basis y=10, restrict y to domain=0:1100, xmin=2, xmax=268435456]
            \addplot table[x=msize, y=core_disabled0_alg6_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            \addplot table[x=msize, y=core_disabled0_alg4_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            \addplot table[x=msize, y=core_disabled0_alg3_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            % \addplot table[x=msize, y=core_disabled0_alg0_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            \addplot table[x=msize, y=core_disabled0_alg0_scotch1] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            \addplot table[x=msize, y=core_disabled1_alg0_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            
            \nextgroupplot[title=GPU By Node, xmode=log, log basis x=2, ymode=log, log basis y=10, restrict y to domain=0:1100, xmin=2, xmax=268435456]
            \addplot table[x=msize, y=rsa] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bynode_128.dat};
            \addplot table[x=msize, y=ring] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bynode_128.dat};
            \addplot table[x=msize, y=rdouble] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bynode_128.dat};
            % \addplot table[x=msize, y=min] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bynode_128.dat};
            \addplot table[x=msize, y=scotch] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bynode_128.dat};
            \addplot table[x=msize, y=def] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/mandm/data/ar_gpu_bynode_128.dat};
            
            \nextgroupplot[title=CPU By Node, xmode=log, log basis x=2, ymode=log, log basis y=10, restrict y to domain=0:1100, xmin=2, xmax=268435456]
            \addplot table[x=msize, y=node_disabled0_alg6_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            \addplot table[x=msize, y=node_disabled0_alg4_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            \addplot table[x=msize, y=node_disabled0_alg3_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            % \addplot table[x=msize, y=node_disabled0_alg0_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            \addplot table[x=msize, y=node_disabled0_alg0_scotch1] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            \addplot table[x=msize, y=node_disabled1_alg0_scotch0] {3_Chapters/4_Chapter_TopologyAwareness/Figs/data/beluga/cpu_128_ar.dat};
            
            \addlegendentry{RSA}
            \addlegendentry{Ring}
            \addlegendentry{Recursive Doubling}
            % \addlegendentry{Remaping}
            \addlegendentry{SCOTCH}
            \addlegendentry{OMPI}
            
        \end{groupplot}
    \end{tikzpicture}
    \caption[Rank Reordered Allreduce Microbenchmark Results on Beluga]{
        OSU Microbenchmark allreduce evaluation on Beluga with 128 nodes.
        GPU nodes have 4 processes each, totalling 512 GPUs total, and CPU allocations have 32 processes per node for 4096 processes total.
        Message sizes range from 4B to 256MB on GPU resources and 4B to 64MB on CPU resources.
    }
    \label{fig:beluga-ar-128}
\end{figure*}