\begin{figure*}
    \centering
    \begin{tikzpicture}
        \begin{groupplot}[group style={
                        group size=2 by 3,
                        xlabels at=edge bottom,
                        ylabels at=edge left,
                        xticklabels at=edge bottom,
                        yticklabels at=edge left,
                        vertical sep=1.5cm,
                    },
                height=5.7cm,
                width=7.5cm,
                xlabel={Message Size (Bytes)},
                ylabel={Fractional Improvement},
                legend style={at={(-0.1,-0.3)}, anchor=north},
                legend columns=3,
                ymin = -0.5,
                ymax = 1,
                xmin = 1,
                xmax = 1073741824,
                grid=both,
            ]
            \nextgroupplot[xmode=log, title=GPU By Socket]
            \addplot table[x=msize, y=rsa_dif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bysoc_gpu_2.dat};
            \addplot table[x=msize, y=ring_dif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bysoc_gpu_2.dat};
            \addplot table[x=msize, y=rdouble_dif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bysoc_gpu_2.dat};
            
            \nextgroupplot[xmode=log, title=CPU By Socket]
            \addplot table[x=msize, y=rsa_pdif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bysoc_cpu_2.dat};
            \addplot table[x=msize, y=ring_pdif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bysoc_cpu_2.dat};
            \addplot table[x=msize, y=rdouble_pdif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bysoc_cpu_2.dat};
            
            \nextgroupplot[xmode=log, title=GPU By Core]
            \addplot table[x=msize, y=rsa_dif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bycore_gpu_2.dat};
            \addplot table[x=msize, y=ring_dif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bycore_gpu_2.dat};
            \addplot table[x=msize, y=rdouble_dif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bycore_gpu_2.dat};
            
            \nextgroupplot[xmode=log, title=CPU By Core, legend]
            \addplot table[x=msize, y=rsa_pdif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bycore_cpu_2.dat};
            \addplot table[x=msize, y=ring_pdif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bycore_cpu_2.dat};
            \addplot table[x=msize, y=rdouble_pdif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bycore_cpu_2.dat};
            
            \nextgroupplot[xmode=log, title=GPU By Node, xticklabels={8B, 1kB, 64kB, 8MB}]
            \addplot table[x=msize, y=rsa_dif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bynode_gpu_2.dat};
            \addplot table[x=msize, y=ring_dif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bynode_gpu_2.dat};
            \addplot table[x=msize, y=rdouble_dif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bynode_gpu_2.dat};
            
            
            \nextgroupplot[xmode=log, title=CPU By Node, xticklabels={8B, 1kB, 64kB, 8MB}]
            \addplot table[x=msize, y=rsa_pdif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bynode_cpu_2.dat};
            \addplot table[x=msize, y=ring_pdif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bynode_cpu_2.dat};
            \addplot table[x=msize, y=rdouble_pdif] {3_Chapters/4_Chapter_TopologyAwareness/Figures/data/beluga/ar/bynode_cpu_2.dat};
            
            \addlegendentry{RSA}
            \addlegendentry{Ring}
            \addlegendentry{Recursive Doubling}
            
        \end{groupplot}
    \end{tikzpicture}
    \caption{Fractional improvement of Allreduce heuristics on Beluga.
    CPU and GPU were evaluated with by-socket, by-core and by-node initial mappings.
    Messages varry from 4B to 128MB.}
    \label{fig:beluga-ar-frac-imprv}
\end{figure*}

